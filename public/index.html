<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="index.css">
    <title>タイトル</title>
</head>
<header>
    <h1>タイトル</h1>
</header>
<section class="about">
    <h2>このサイトについて</h2>
    <p class="description">
        当サイトでは、新入生の皆さんを対象とした新歓イベント情報を提供しています。各サークルや部活動、学生団体のイベント情報が盛りだくさん！楽しいイベントや興味深い活動を見つけて、新たな仲間と出会いましょう。
        サイトの投稿リストには、各イベントのタイトル、主催団体の名前、そして簡単な紹介文が掲載されています。興味を持ったイベントがあれば、詳細ページにアクセスして、イベントの日時や場所、参加方法などを確認してください。新たな一歩を踏み出して、素晴らしい大学生活をスタートさせましょう！
    </p>
</section>
<section class="posts">
    <h2>最新のイベント</h2>
    <ul class="post-list"></ul>
</section>

<footer>
    <p>© 2023 </p>
</footer>

<script>
    //投稿板欄が入った配列
    let posts = [{
        id: "1",
        title: "投稿1のタイトル",
        date: "2023/03/22",
        name: "田中太郎",
        description: "ここでパーティをします！",
        participants: "5"
    },
    {
        id: "2",
        title: "投稿2のタイトル",
        date: "2023/03/23",
        name: "山田花子",
        description: "ここでパーティをします！",
        participants: "3"
    },
    {
        id: "3",
        title: "投稿3のタイトル",
        date: "2023/03/24",
        name: "佐藤次郎",
        description: "ここでパーティをします！",
        participants: "4"
    }];

    //更新時にDBにリクエストしてデータをpostに追加する
    window.onload = async () => {
        const response = await fetch("/get-posts");
        console.log(response);
        posts = await response.json();
        console.log(posts);
    }

    const postList = document.querySelector(".post-list");

    posts.forEach(post => {
        const listItem = document.createElement("li");
        const postTitle = document.createElement("h3");

        postTitle.textContent = post.title;
        postTitle.classList.add("post-title");
        listItem.appendChild(postTitle);

        const postDate = document.createElement("p");
        postDate.textContent = "開催日時: " + post.date;
        postDate.classList.add("post-date");
        listItem.appendChild(postDate);

        const postName = document.createElement("p");
        postName.textContent = "名前: " + post.name;
        postName.classList.add("post-name");
        listItem.appendChild(postName);

        const postDescription = document.createElement("p");
        postDescription.textContent = "紹介文: " + post.description;
        postDescription.classList.add("post-description");
        listItem.appendChild(postDescription);

        //参加ボタン
        const joinButton = document.createElement("button");
        joinButton.textContent = "参加します";
        joinButton.classList.add("join-button");
        listItem.appendChild(joinButton);

        //参加者数表示する要素
        const participantCount = document.createElement("p");
        participantCount.textContent = "参加者数: " + post.participants;
        participantCount.classList.add("participant-count");
        listItem.appendChild(participantCount);

        // const participantCount = document.createElement("p");
        // participantCount.textContent = "";

        joinButton.addEventListener("click", async () => {
            joinButton.style.backgroundColor = "green";
            joinButton.textContent = "参加しました";

            const response = await fetch("/add-participants", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ "id": post.id })
            })

            //更新されたPost一覧取得
            // posts = await response.json();
            const data = await response.json();
            posts = data.posts;
            const post = posts.find(post => post.id === data.id);
            const numParticipants = post.participants;

            //参加者数表示
        });

        listItem.classList.add("post");
        postList.appendChild(listItem);
    });
</script>
</body>

</html>